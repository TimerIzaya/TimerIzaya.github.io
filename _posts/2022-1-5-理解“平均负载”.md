---
layout:     post
title:      理解“平均负载”
subtitle:   运维也要学一点点
date:       2022-1-5
author:     Timer
header-img: img/the-first.png
catalog: false
tags:
    - linux
    - OS

---

## 如何查询平均负载？

```shell
uptime
```

```shell
16:52:56 up 30 days,  4:36,  1 user,  load average: 0.00, 0.00, 0.00
```

其中 load average后分别为1分钟、5分钟、15分钟的平均负载。



## 平均负载的定义和使用

简单来说，平均负载是指单位时间内，系统处于**可运行状态**和**不可中断状态**的平均进程数，也就是**平均活跃进程数**，它和 CPU 使用率并没有直接关系。

所谓**可运行状态的进程**，是指正在使用 CPU 或者正在等待 CPU 的进程，也就是用ps 或者top命令看到的，处于 **R** 状态（Running 或 Runnable）的进程。

不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I/O 响应，也就是我们在 ps 命令中看到的 **D** 状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程。

**当平均负载为2时：**

- 在2核CPU系统中，意味着所有CPU都刚好被占用。
- 在4核CPU系统中，意味着CPU有50%的算力空闲。
- 在1核CPU系统中，意味着有一半的进程竞争不到CPU。

**平均负载最理想的情况是等于 CPU 个数。当平均负载高于 CPU 数量 70% 的时候**，就应该分析排查负载高的问题了。

一旦负载过高，就可能导致进程响应变慢，进而影响服务的正常功能。

但 70% 这个数字并不是绝对的，最合适的方法是把系统的平均负载监控起来，然后根据更多的历史数据，判断负载的变化趋势。当发现负载有明显升高趋势时，比如说负载翻倍了，再去做分析和调查。  

## **平均负载与** **CPU** **使用率**

要回到平均负载的含义上来，平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。所以，它不仅包括了**正在使用 CPU** 的进程，还包括**等待 CPU** 和**等待I/O** 的进程。

而 CPU 使用率，是单位时间内 CPU 繁忙情况的统计，跟平均负载并不一定完全对应。比如：

- **CPU 密集型进程**，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；

- **I/O 密集型进程**，等待 I/O 也会导致平均负载升高，但 CPU 使用率不一定很高；

- 大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高。



























